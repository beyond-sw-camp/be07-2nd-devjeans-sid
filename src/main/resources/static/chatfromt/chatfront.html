<!DOCTYPE html>
<html>
<head>
    <title>STOMP WebSocket Chat</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.2/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script>
        var stompClient = null;
        var chatRoomId = 1;  // 예제에서는 고정된 chatRoomId를 사용합니다. 실제로는 동적으로 설정할 수 있습니다.
        var userId = 1;      // 예제에서는 고정된 userId를 사용합니다. 실제로는 동적으로 설정할 수 있습니다.
        var receiverId = 2;  // 예제에서는 고정된 receiverId를 사용합니다. 실제로는 동적으로 설정할 수 있습니다.

        function connect() {
            var socket = new SockJS('/ws');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function (frame) {
                console.log('Connected: ' + frame);

                // 수신할 메시지를 구독합니다.
                stompClient.subscribe('/sub/chatroom/' + chatRoomId, function (message) {
                    showMessage(JSON.parse(message.body));
                });
            });

            socket.onclose = function() {
                console.log('WebSocket connection closed');
                // 연결이 끊겼을 때 추가적인 처리를 할 수 있습니다.
            }
        }

        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect();
            }
            console.log("Disconnected");
        }

        function sendMessage() {
            var messageContent = document.getElementById("messageInput").value;
            if (messageContent && stompClient) {
                var chatMessage = {
                    senderId: userId,
                    content: messageContent,
                    timestamp: new Date()
                };
                stompClient.send("/pub/" + chatRoomId + "/receiver/" + receiverId, {}, JSON.stringify(chatMessage));
                document.getElementById("messageInput").value = '';
            }
        }

        function showMessage(message) {
            var messagesDiv = document.getElementById("messages");
            var messageElement = document.createElement('div');
            messageElement.innerText = message.senderId + ": " + message.content + " (" + new Date(message.timestamp).toLocaleTimeString() + ")";
            messagesDiv.appendChild(messageElement);
        }

        window.onload = function() {
            connect();
        };
    </script>
</head>
<body>
<div>
    <input type="text" id="messageInput" placeholder="Type your message here...">
    <button onclick="sendMessage()">Send</button>
</div>
<div id="messages"></div>
<button onclick="disconnect()">Disconnect</button>
</body>
</html>
